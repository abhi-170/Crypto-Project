<!doctype html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Searchable Encryption</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <style>
      :root {
        --bg-hero-start: #0d6efd;
        --bg-hero-end: #6610f2;
      }
      .token { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
      pre.code { background:#0b1220; color:#eaeef3; padding:1rem; border-radius:10px; }
      .hero {
        background: linear-gradient(135deg, var(--bg-hero-start), var(--bg-hero-end));
        color: #fff;
        border-radius: 14px;
        padding: 1.25rem 1.5rem;
        margin: 1rem 0 1.5rem 0;
      }
      .stat-card {
        border: 0;
        border-radius: 12px;
      }
      .glass {
        background: rgba(255,255,255,0.7);
        backdrop-filter: blur(6px);
      }
      .toast-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1080;
      }
      .dropzone {
        border: 2px dashed #adb5bd;
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
        transition: border-color .2s ease;
      }
      .dropzone.dragover {
        border-color: #0d6efd;
        background: rgba(13,110,253,.05);
      }
      .spinner-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,.35);
        display: none; align-items: center; justify-content: center; z-index: 2000;
      }
      .scroll-section { max-height: 360px; overflow: auto; }
    </style>
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand fw-semibold" href="/"><i class="bi bi-shield-lock"></i> Searchable Encryption</a>
      </div>
    </nav>

    <main class="container py-4">
      <div class="hero">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <div>
            <h1 class="h3 mb-1">Secure Cloud Document Sharing</h1>
            <p class="mb-0 opacity-75">Upload, encrypt, search with trapdoors, validate confidentiality, and test scalability â€” all in your browser.</p>
          </div>
        </div>
      </div>

      <!-- Hidden flash messages to be converted to toasts -->
      <div id="flash-source" class="d-none">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div data-category="{{ category }}" data-message="{{ message | e }}"></div>
            {% endfor %}
          {% endif %}
        {% endwith %}
      </div>

      <div class="toast-container" id="toastContainer"></div>

      {% block content %}{% endblock %}
    </main>

    <div class="spinner-overlay" id="spinnerOverlay">
      <div class="spinner-border text-light" role="status" style="width:3rem;height:3rem;">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
      // Flash toasts
      const src = document.getElementById('flash-source');
      const toastContainer = document.getElementById('toastContainer');
      for(const el of src.children){
        const cat = el.getAttribute('data-category') || 'info';
        const msg = el.getAttribute('data-message') || '';
        const wrapper = document.createElement('div');
        wrapper.className = 'toast align-items-center text-bg-' + (cat==='danger'?'danger':cat==='warning'?'warning':cat==='success'?'success':'secondary') + ' border-0';
        wrapper.setAttribute('role','alert'); wrapper.setAttribute('aria-live','assertive'); wrapper.setAttribute('aria-atomic','true');
        wrapper.innerHTML = `<div class="d-flex"><div class="toast-body">${msg}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>`;
        toastContainer.appendChild(wrapper);
        new bootstrap.Toast(wrapper, { delay: 3500 }).show();
      }

      // Global spinner helpers
      window.showSpinner = () => document.getElementById('spinnerOverlay').style.display='flex';
      window.hideSpinner = () => document.getElementById('spinnerOverlay').style.display='none';
      // Toast helper
      window.toast = (text, type='secondary') => {
        const wrapper = document.createElement('div');
        wrapper.className = 'toast align-items-center text-bg-' + type + ' border-0';
        wrapper.innerHTML = `<div class="d-flex"><div class="toast-body">${text}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>`;
        toastContainer.appendChild(wrapper);
        new bootstrap.Toast(wrapper, { delay: 3000 }).show();
      }
    </script>
  </body>
</html>
